<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‚Äî ‡∏™‡∏±‡∏ï‡∏ß‡πå 4 ‡∏ó‡∏¥‡∏®</title>
<style>
  :root{
    --bg:#f6fbff; --card:#ffffff; --muted:#6b7280;
    --accent:#7fb2ff; --accent2:#ffd08a;
    font-family: "Noto Sans Thai", Roboto, Arial, sans-serif;
  }
  body{ margin:0; background:linear-gradient(180deg,var(--bg),#fff ); color:#0f172a; }
  header{ padding:24px; text-align:center; }
  h1{ margin:0; font-size:1.6rem; }
  .container{ max-width:960px; margin:18px auto; padding:12px; }
  .grid{ display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); }
  .card{ background:var(--card); border-radius:12px; padding:14px; box-shadow: 0 6px 18px rgba(15,23,42,0.06); }
  .animal-card{ display:flex; flex-direction:column; align-items:center; text-align:center; padding:18px; cursor:pointer; transition:transform .16s; }
  .animal-card:hover{ transform:translateY(-6px); }
  .animal-icon{ font-size:48px; margin-bottom:8px; }
  .muted{ color:var(--muted); font-size:.95rem; }
  .btn{ display:inline-block; padding:8px 12px; border-radius:8px; background:var(--accent); color:white; text-decoration:none; cursor:pointer; border:none; }
  .btn.secondary{ background:transparent; color:var(--accent); border:1px solid #dbeafe; }
  .quiz-q{ margin-bottom:10px; }
  .progress{ height:10px; background:#e6eefc; border-radius:999px; overflow:hidden; }
  .progress > i{ display:block; height:100%; background:linear-gradient(90deg,var(--accent),var(--accent2)); width:0%; }
  .result { text-align:center; padding:18px; }
  textarea{ width:100%; min-height:88px; resize:vertical; padding:8px; border-radius:8px; border:1px solid #e6eefc; }
  footer{ text-align:center; color:var(--muted); font-size:.85rem; padding:18px; }
  .small{ font-size:.9rem; color:var(--muted); }
  .inline-row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .slider{ width:100%; }
  .controls{ display:flex; gap:8px; justify-content:center; margin-top:10px; flex-wrap:wrap; }
  @media (max-width:420px){ header{ padding:12px } h1{ font-size:1.2rem } }
</style>
</head>
<body>
<header>
    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô -->
  <img src="images/header-banner.jpg" alt="‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°" style="max-width:100%; height:auto; border-radius:12px; margin-bottom:16px;">
  
  <h1>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‚Äî ‡∏™‡∏±‡∏ï‡∏ß‡πå 4 ‡∏ó‡∏¥‡∏® üêòü¶Åüê¶üê¢</h1>
  <p class="muted">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡πà‡∏≤‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏Ñ‡∏∏‡∏ì ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡πÉ‡∏ô‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏≠‡∏î‡∏µ‡∏ï-‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô-‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï</p>
</header>

<div class="container">

  <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á -->
  <div class="card">
    <h3>1) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
    <div class="grid" id="direct-select">
      <div class="card animal-card" data-animal="elephant">
        <div class="animal-icon">üêò</div>
        <strong>‡∏ä‡πâ‡∏≤‡∏á (‡∏ó‡∏¥‡∏®‡πÄ‡∏´‡∏ô‡∏∑‡∏≠)</strong>
        <div class="small muted">‡∏≠‡∏î‡∏ó‡∏ô ¬∑ ‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á ¬∑ ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</div>
      </div>
      <div class="card animal-card" data-animal="lion">
        <div class="animal-icon">ü¶Å</div>
        <strong>‡∏™‡∏¥‡∏á‡πÇ‡∏ï (‡∏ó‡∏¥‡∏®‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å)</strong>
        <div class="small muted">‡∏Å‡∏•‡πâ‡∏≤ ¬∑ ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥ ¬∑ ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à</div>
      </div>
      <div class="card animal-card" data-animal="dove">
        <div class="animal-icon">üê¶</div>
        <strong>‡∏ô‡∏Å‡∏û‡∏¥‡∏£‡∏≤‡∏ö (‡∏ó‡∏¥‡∏®‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å)</strong>
        <div class="small muted">‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏¢‡∏ô ¬∑ ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÄ‡∏Å‡πà‡∏á ¬∑ ‡∏õ‡∏•‡∏≠‡∏ö‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ</div>
      </div>
      <div class="card animal-card" data-animal="turtle">
        <div class="animal-icon">üê¢</div>
        <strong>‡πÄ‡∏ï‡πà‡∏≤ (‡∏ó‡∏¥‡∏®‡πÉ‡∏ï‡πâ)</strong>
        <div class="small muted">‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ¬∑ ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏ö ¬∑ ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</div>
      </div>
    </div>
    <div style="margin-top:12px; text-align:center;">
      <button class="btn" id="start-quiz">‡∏´‡∏£‡∏∑‡∏≠ ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏±‡πâ‡∏ô (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)</button>
      <button class="btn secondary" id="clear-storage">‡∏•‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</button>
    </div>
  </div>

  <!-- ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö -->
  <div class="card" id="quiz-card" style="display:none;">
    <h3>‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏±‡πâ‡∏ô 5 ‡∏Ç‡πâ‡∏≠</h3>
    <div id="quiz-area"></div>
    <div class="controls">
      <button class="btn" id="prev-q" style="display:none">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
      <button class="btn" id="next-q">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
    </div>
    <div style="margin-top:10px;">
      <div class="progress"><i id="progbar"></i></div>
    </div>
  </div>

  <!-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå -->
  <div class="card" id="result-card" style="display:none;">
    <h3>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
    <div class="result" id="result-display"></div>

    <div style="margin-top:10px;">
      <label class="small">‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)</label>
      <input type="range" id="percent-slider" min="0" max="100" value="75" class="slider">
      <div style="text-align:center; margin-top:6px;"><strong id="percent-value">75%</strong></div>
    </div>

    <div style="margin-top:12px; text-align:center;">
      <button class="btn" id="save-reflect">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô</button>
      <button class="btn secondary" id="retry">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
    </div>
  </div>

  <!-- ‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏≠‡∏î‡∏µ‡∏ï-‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô-‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï -->
  <div class="card">
    <h3>‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° ‡∏≠‡∏î‡∏µ‡∏ï ‚Äî ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‚Äî ‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï</h3>
    <div style="display:grid; gap:8px;">
      <div>
        <strong>1) ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ò‡∏≠‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏à</strong>
        <textarea id="past"></textarea>
      </div>
      <div>
        <strong>2) ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ò‡∏≠‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</strong>
        <textarea id="present"></textarea>
      </div>
      <div>
        <strong>3) ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ò‡∏≠‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</strong>
        <textarea id="future"></textarea>
      </div>
      <div style="text-align:center;">
        <button class="btn" id="save-bridge">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏∞‡∏û‡∏≤‡∏ô</button>
        <button class="btn secondary" id="load-bridge">‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</button>
      </div>
    </div>
  </div>

  <!-- ‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á / ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° -->
  <div class="card">
    <h3>‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á & ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå</h3>
    <p class="small muted">‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢ (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ) ‚Äî ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô <code>&lt;audio src="yourfile.mp3"&gt;</code> ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
    <div class="inline-row">
      <button class="btn" id="toggle-music">‡πÄ‡∏£‡∏¥‡πà‡∏°/‡∏´‡∏¢‡∏∏‡∏î ‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</button>
      <button class="btn secondary" id="toggle-beep">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
    </div>
  </div>

  <!-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å -->
  <div class="card" id="saved-card" style="display:none;">
    <h3>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
    <div id="saved-area"></div>
    <div style="text-align:center; margin-top:8px;"><button class="btn" id="export-json">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î (JSON)</button></div>
  </div>

</div>

<footer>
  <div class="muted">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‚Äî ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</div>
</footer>

<script>
/* ====== ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå (‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•) ====== */
const animals = {
  elephant:{
    id:'elephant', name:'‡∏ä‡πâ‡∏≤‡∏á (‡∏ó‡∏¥‡∏®‡πÄ‡∏´‡∏ô‡∏∑‡∏≠)', icon:'üêò',
    desc:'‡∏≠‡∏î‡∏ó‡∏ô ¬∑ ‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á ¬∑ ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö', tip:'‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏î‡∏ó‡∏ô ‡πÅ‡∏ï‡πà‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏î‡∏¢‡∏≤‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô'
  },
  lion:{
    id:'lion', name:'‡∏™‡∏¥‡∏á‡πÇ‡∏ï (‡∏ó‡∏¥‡∏®‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å)', icon:'ü¶Å',
    desc:'‡∏Å‡∏•‡πâ‡∏≤ ¬∑ ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥ ¬∑ ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à', tip:'‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥ ‡πÅ‡∏ï‡πà‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÉ‡∏à‡∏£‡πâ‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ'
  },
  dove:{
    id:'dove', name:'‡∏ô‡∏Å‡∏û‡∏¥‡∏£‡∏≤‡∏ö (‡∏ó‡∏¥‡∏®‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å)', icon:'üê¶',
    desc:'‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏¢‡∏ô ¬∑ ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÄ‡∏Å‡πà‡∏á ¬∑ ‡∏õ‡∏•‡∏≠‡∏ö‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ', tip:'‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÑ‡∏î‡πâ‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á'
  },
  turtle:{
    id:'turtle', name:'‡πÄ‡∏ï‡πà‡∏≤ (‡∏ó‡∏¥‡∏®‡πÉ‡∏ï‡πâ)', icon:'üê¢',
    desc:'‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ¬∑ ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏ö ¬∑ ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥', tip:'‡∏á‡∏≤‡∏ô‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á ‡πÅ‡∏ï‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏´‡πâ‡∏ù‡∏∂‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß'
  }
};

/* ====== ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏±‡πâ‡∏ô ‡πÜ (‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏™‡∏±‡∏ï‡∏ß‡πå) ====== */
const quizQuestions = [
  { q:'‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏à‡∏≠‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏≤‡∏Å ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?', choices:[
      {t:'‡∏ó‡∏≥‡∏ä‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á', score:{elephant:2,turtle:1}},
      {t:'‡∏à‡∏±‡∏ö‡∏à‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡∏°‡∏ó‡∏≥‡∏ó‡∏±‡∏ô‡∏ó‡∏µ', score:{lion:2}},
      {t:'‡∏õ‡∏•‡∏≠‡∏ö‡πÉ‡∏à‡∏ó‡∏µ‡∏°‡πÅ‡∏•‡∏∞‡∏´‡∏≤‡πÇ‡∏ã‡∏•‡∏π‡∏ä‡∏±‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô', score:{dove:2}},
      {t:'‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö', score:{turtle:2,elephant:1}},
    ]},
  { q:'‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÑ‡∏´‡∏ô?', choices:[
      {t:'‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°/‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à', score:{lion:2}},
      {t:'‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏â‡∏≤‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î', score:{turtle:2}},
      {t:'‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à-‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô', score:{dove:2}},
      {t:'‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÅ‡∏°‡πâ‡∏ä‡πâ‡∏≤‡πÅ‡∏ï‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô', score:{elephant:2}},
    ]},
  { q:'‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏´‡πâ ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞?', choices:[
      {t:'‡∏Å‡∏≠‡∏î/‡∏û‡∏π‡∏î‡∏õ‡∏•‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏¢‡∏ô', score:{dove:3}},
      {t:'‡∏à‡∏±‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î', score:{turtle:1,elephant:1}},
      {t:'‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏ï‡∏£‡∏á‡∏°‡∏≤', score:{lion:1}},
    ]},
  { q:'‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏à‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡πá‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å?', choices:[
      {t:'‡∏Å‡∏±‡∏á‡∏ß‡∏• ‡πÅ‡∏ï‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÑ‡∏î‡πâ', score:{elephant:1,dove:1}},
      {t:'‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏°‡∏ó‡∏≥‡∏ï‡∏≤‡∏°', score:{lion:2}},
      {t:'‡∏ä‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô ‚Äî ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î', score:{turtle:2}},
    ]},
  { q:'‡∏á‡∏≤‡∏ô‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô?', choices:[
      {t:'‡∏°‡∏∑‡∏≠‡πÄ‡∏¢‡πá‡∏ô ‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÅ‡∏°‡πà‡∏ô', score:{turtle:3}},
      {t:'‡∏ä‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏µ‡∏°', score:{lion:1}},
      {t:'‡∏Ñ‡∏≠‡∏¢‡∏î‡∏π‡πÅ‡∏•‡πÉ‡∏à‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡∏Ç‡∏ì‡∏∞‡∏ó‡∏≥', score:{dove:1}},
      {t:'‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à', score:{elephant:1}},
    ]},
];

/* ====== ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ====== */
let quizState = { idx:0, answers:[] };
let currentSelectedAnimal = null;
let musicOn = false; let beepOn = true;

/* ====== DOM ====== */
const directSelect = document.getElementById('direct-select');
const startQuizBtn = document.getElementById('start-quiz');
const quizCard = document.getElementById('quiz-card');
const quizArea = document.getElementById('quiz-area');
const prevBtn = document.getElementById('prev-q');
const nextBtn = document.getElementById('next-q');
const progbar = document.getElementById('progbar');
const resultCard = document.getElementById('result-card');
const resultDisplay = document.getElementById('result-display');
const percentSlider = document.getElementById('percent-slider');
const percentValue = document.getElementById('percent-value');
const saveReflectBtn = document.getElementById('save-reflect');
const retryBtn = document.getElementById('retry');
const pastTa = document.getElementById('past');
const presentTa = document.getElementById('present');
const futureTa = document.getElementById('future');
const saveBridgeBtn = document.getElementById('save-bridge');
const loadBridgeBtn = document.getElementById('load-bridge');
const toggleMusicBtn = document.getElementById('toggle-music');
const toggleBeepBtn = document.getElementById('toggle-beep');
const savedCard = document.getElementById('saved-card');
const savedArea = document.getElementById('saved-area');
const clearStorageBtn = document.getElementById('clear-storage');
const exportJsonBtn = document.getElementById('export-json');

/* ====== ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ====== */
directSelect.querySelectorAll('.animal-card').forEach(card=>{
  card.addEventListener('click', ()=> {
    const id = card.dataset.animal;
    if(beepOn) playClick();
    currentSelectedAnimal = id;
    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    showResult({animal:id, percent: Math.floor(60 + Math.random()*30)});
  });
});

/* ====== ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö ====== */
startQuizBtn.addEventListener('click', ()=>{
  quizCard.style.display = 'block';
  resultCard.style.display = 'none';
  quizState = { idx:0, answers:[] };
  renderQuestion();
});

/* ====== ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ====== */
function renderQuestion(){
  const i = quizState.idx;
  const q = quizQuestions[i];
  quizArea.innerHTML = `
    <div class="quiz-q">
      <strong>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ${i+1}/${quizQuestions.length}:</strong>
      <div style="margin-top:8px;">${q.q}</div>
      <div style="margin-top:10px; display:grid; gap:8px;">
        ${q.choices.map((c,ci)=>`<label style="display:block; padding:8px; border-radius:8px; border:1px solid #eef6ff; cursor:pointer;">
          <input type="radio" name="qchoice" value="${ci}" ${quizState.answers[i]==ci?'checked':''}/> ${c.t}
        </label>`).join('')}
      </div>
    </div>
  `;
  prevBtn.style.display = i>0?'inline-block':'none';
  nextBtn.textContent = i === quizQuestions.length-1 ? '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö' : '‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
  const prog = Math.round((i / quizQuestions.length) * 100);
  progbar.style.width = prog + '%';
}

/* ====== ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ/‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö ====== */
nextBtn.addEventListener('click', ()=>{
  const radios = document.querySelectorAll('input[name="qchoice"]');
  const checked = Array.from(radios).find(r=>r.checked);
  if(!checked){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô'); return; }
  quizState.answers[quizState.idx] = parseInt(checked.value);
  if(quizState.idx < quizQuestions.length-1){
    quizState.idx++;
    renderQuestion();
  } else {
    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•
    const scores = { elephant:0, lion:0, dove:0, turtle:0 };
    quizState.answers.forEach((a,idx)=>{
      const ch = quizQuestions[idx].choices[a];
      for(const k in ch.score) scores[k] = (scores[k]||0)+ch.score[k];
    });
    // ‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
    const sorted = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
    const top = sorted[0][0];
    // percent = topScore / sumScores normalized
    const sumScores = Object.values(scores).reduce((s,n)=>s+n,0) || 1;
    const percent = Math.round((scores[top]/sumScores)*100);
    showResult({animal:top, percent});
  }
});

prevBtn.addEventListener('click', ()=>{
  if(quizState.idx>0){ quizState.idx--; renderQuestion(); }
});

/* ====== ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ====== */
function showResult({animal, percent}){
  currentSelectedAnimal = animal;
  quizCard.style.display = 'none';
  resultCard.style.display = 'block';
  const a = animals[animal];
  resultDisplay.innerHTML = `
    <div style="font-size:48px">${a.icon}</div>
    <h3 style="margin:6px 0;">${a.name}</h3>
    <div class="muted">${a.desc}</div>
    <p style="margin-top:8px;">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${a.tip}</p>
  `;
  percentSlider.value = percent;
  percentValue.textContent = percent + '%';
  progbar.style.width = '100%';
  if(beepOn) playSuccess();
}

/* ====== ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå ====== */
percentSlider.addEventListener('input', ()=>{
  percentValue.textContent = percentSlider.value + '%';
});

/* ====== ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô (result + bridge) ====== */
saveReflectBtn.addEventListener('click', ()=>{
  const entry = {
    timestamp: new Date().toISOString(),
    animal: currentSelectedAnimal,
    percent: parseInt(percentSlider.value),
    past: pastTa.value,
    present: presentTa.value,
    future: futureTa.value
  };
  // ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô localStorage
  const arr = JSON.parse(localStorage.getItem('selfReflect') || '[]');
  arr.unshift(entry);
  localStorage.setItem('selfReflect', JSON.stringify(arr));
  alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ');
  renderSaved();
});

/* ====== ‡∏™‡∏∞‡∏û‡∏≤‡∏ô ‚Äî ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡πÇ‡∏´‡∏•‡∏î ====== */
saveBridgeBtn.addEventListener('click', ()=>{
  const bridge = { past: pastTa.value, present: presentTa.value, future: futureTa.value, when: new Date().toISOString() };
  localStorage.setItem('bridgeReflect', JSON.stringify(bridge));
  alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ');
  renderSaved();
});
loadBridgeBtn.addEventListener('click', ()=>{
  const b = JSON.parse(localStorage.getItem('bridgeReflect')||'null');
  if(!b){ alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á'); return; }
  pastTa.value = b.past; presentTa.value = b.present; futureTa.value = b.future;
  alert('‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
});

/* ====== ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ ====== */
function renderSaved(){
  const arr = JSON.parse(localStorage.getItem('selfReflect') || '[]');
  if(arr.length===0){ savedCard.style.display='none'; return; }
  savedCard.style.display='block';
  savedArea.innerHTML = arr.slice(0,10).map(item=>`
    <div style="border-bottom:1px solid #eef6ff; padding:8px 0;">
      <div style="display:flex; justify-content:space-between; gap:10px; align-items:center;">
        <div><strong>${animals[item.animal].icon} ${animals[item.animal].name}</strong> ‚Äî ${item.percent}%</div>
        <div class="small">${new Date(item.timestamp).toLocaleString()}</div>
      </div>
      <div class="muted small" style="margin-top:6px;">
        <strong>‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏à:</strong> ${escapeHtml(item.past || '-')}<br/>
        <strong>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥:</strong> ${escapeHtml(item.present || '-')}<br/>
        <strong>‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≥:</strong> ${escapeHtml(item.future || '-')}
      </div>
    </div>
  `).join('');
}

/* ====== ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà & ‡∏•‡πâ‡∏≤‡∏á ====== */
retryBtn.addEventListener('click', ()=>{ quizCard.style.display='none'; resultCard.style.display='none'; currentSelectedAnimal=null; });
clearStorageBtn.addEventListener('click', ()=>{
  if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏´‡∏°?')){ localStorage.removeItem('selfReflect'); localStorage.removeItem('bridgeReflect'); renderSaved(); alert('‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); }
});

/* ====== ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î JSON ====== */
exportJsonBtn.addEventListener('click', ()=>{
  const arr = JSON.parse(localStorage.getItem('selfReflect') || '[]');
  const blob = new Blob([JSON.stringify(arr, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download = 'self_reflect.json'; a.click();
  URL.revokeObjectURL(url);
});

/* ====== ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (WebAudio) ====== */
let audioCtx, bgOsc, bgGain;
function initAudio(){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  bgOsc = audioCtx.createOscillator();
  bgGain = audioCtx.createGain();
  bgOsc.type = 'sine';
  bgOsc.frequency.value = 220; // base tone
  bgGain.gain.value = 0;
  bgOsc.connect(bgGain);
  bgGain.connect(audioCtx.destination);
  bgOsc.start();

  // LFO for gentle wobble
  const lfo = audioCtx.createOscillator();
  const lfoGain = audioCtx.createGain();
  lfo.type = 'sine'; lfo.frequency.value = 0.15; lfoGain.gain.value = 30;
  lfo.connect(lfoGain);
  lfoGain.connect(bgOsc.frequency);
  lfo.start();
}
function startMusic(){
  initAudio();
  bgGain.gain.linearRampToValueAtTime(0.03, audioCtx.currentTime + 0.5);
  musicOn = true;
  toggleMusicBtn.textContent = '‡∏´‡∏¢‡∏∏‡∏î ‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á';
}
function stopMusic(){
  if(!audioCtx) return;
  bgGain.gain.linearRampToValueAtTime(0.0001, audioCtx.currentTime + 0.5);
  musicOn = false;
  toggleMusicBtn.textContent = '‡πÄ‡∏£‡∏¥‡πà‡∏°/‡∏´‡∏¢‡∏∏‡∏î ‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á';
}
toggleMusicBtn.addEventListener('click', ()=>{
  if(!audioCtx || !musicOn) startMusic(); else stopMusic();
});

/* ====== ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏±‡πâ‡∏ô ‡πÜ ====== */
function playClick(){
  try{
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type='triangle'; o.frequency.value = 880;
    g.gain.value = 0.0001;
    o.connect(g); g.connect(ctx.destination);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.06, ctx.currentTime + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.15);
    o.stop(ctx.currentTime + 0.16);
  }catch(e){}
}
function playSuccess(){
  try{
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o1 = ctx.createOscillator(); const o2 = ctx.createOscillator();
    const g = ctx.createGain(); g.gain.value=0.0001;
    o1.type='sine'; o2.type='sine';
    o1.frequency.value = 660; o2.frequency.value = 880;
    o1.connect(g); o2.connect(g); g.connect(ctx.destination);
    o1.start(); o2.start();
    g.gain.exponentialRampToValueAtTime(0.07, ctx.currentTime + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.32);
    o1.stop(ctx.currentTime + 0.34); o2.stop(ctx.currentTime + 0.34);
  }catch(e){}
}
toggleBeepBtn.addEventListener('click', ()=>{ beepOn = !beepOn; toggleBeepBtn.textContent = beepOn ? '‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å' : '‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö'; });

/* ====== ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ====== */
function init(){
  renderSaved();
  // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
  const b = JSON.parse(localStorage.getItem('bridgeReflect')||'null');
  if(b){ pastTa.value=b.past || ''; presentTa.value=b.present || ''; futureTa.value=b.future || ''; }
}
init();

/* ====== ‡∏¢‡∏π‡∏ó‡∏¥‡∏•‡∏¥‡∏ï‡∏µ‡πâ ====== */
function escapeHtml(s){ if(!s) return ''; return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br/>'); }

/* ====== Accessibility: ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠ resume audio context) ====== */
document.addEventListener('click', function one(){ 
  if(window.AudioContext && !audioCtx){
    // prepare audio context but don't play
    initAudio();
    stopMusic();
  }
  document.removeEventListener('click', one);
});

</script>
</body>
</html>
